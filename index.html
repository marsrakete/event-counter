<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="512x512" href="event-counter-icon.png">
  <title>Event Counter</title>
  <style>
    body{background:#0f1115;color:#eef2f6;font-family:sans-serif;padding:1rem}
    h1{text-align:center}
    .event{background:#171a21;padding:1rem;margin:1rem auto;border-radius:1rem;max-width:900px}
    .count-buttons button[disabled]{background:#2a2f3a;color:#cfd8dc;cursor:not-allowed}
    button{margin:.2rem;padding:.5rem .8rem;border-radius:.5rem;cursor:pointer}
    .btn-primary{background:#4f8cc9;color:#fff;border:none}
    .btn-warning{background:#fbc02d;color:#111;border:none}
    .btn-danger{background:#ef5350;color:#fff;border:none}
    .btn-accent{background:#00bcd4;color:#fff;border:none}
    .btn-ghost{background:transparent;border:1px solid #444;color:#9aa4ad}
    #trash{background:#171a21;border-radius:1rem;padding:1rem;margin-top:1rem;display:none}
    #trash h2{margin-top:0}
    .trash-item{border:1px dashed #444;padding:.5rem;margin:.3rem 0;border-radius:.5rem}
  
    .header-row{display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;margin-bottom:.5rem}
    .status-badge{display:inline-flex;align-items:center;gap:.4rem;padding:.25rem .55rem;border-radius:999px;font-size:.85rem;font-weight:600}
    .status-running{background:rgba(46,125,50,.15);color:#66bb6a;border:1px solid rgba(46,125,50,.35)}
    .status-stopped{background:rgba(251,192,45,.15);color:#ffca28;border:1px solid rgba(251,192,45,.35)}
    .status-terminated{background:rgba(84,110,122,.15);color:#90a4ae;border:1px solid rgba(84,110,122,.35)}
        </style>
</head>
<body>
<h1>Event Counter</h1>
<div class="topbar">
  <button class="btn-primary" onclick="createNewEvent()">+ Neues Event</button>
  <button class="btn-ghost" onclick="toggleTrash()">üóëÔ∏è Papierkorb <span id="trash-count">0</span></button>
</div>
<div id="events"></div>
<div id="trash">
  <h2>Papierkorb</h2>
  <div id="trash-events"></div>
  <div id="trash-entries"></div>
  <button class="btn-danger" onclick="emptyTrash()">Papierkorb leeren</button>
</div>
<script>
let events = JSON.parse(localStorage.getItem("events")||"[]");
let trash = {events:[],entries:[]};
const eventsDiv=document.getElementById("events");

function save(){localStorage.setItem("events",JSON.stringify(events));render();}
function createNewEvent(){
  const name=prompt("Event-Name?")||"Neues Event";
  events.push({id:crypto.randomUUID(),name,status:"new",
    entries:[{id:crypto.randomUUID(),label:"Mann",count:0},{id:crypto.randomUUID(),label:"Frau",count:0}]});
  save();
}
function shareEvent(ev){
  const txt=`${ev.name}\n\n`+ev.entries.map(e=>`${e.label}: ${e.count}`).join('\n');
  if(navigator.share){navigator.share({title:"Ergebnis der Z√§hlung",text:txt})
    .catch(()=>window.location.href=`mailto:?subject=Ergebnis der Z√§hlung&body=${encodeURIComponent(txt)}`);}
  else window.location.href=`mailto:?subject=Ergebnis der Z√§hlung&body=${encodeURIComponent(txt)}`;
}
function render(){
  eventsDiv.innerHTML="";
  events.forEach((event,idx)=>{
    const card=document.createElement("div");card.className="event";
    const header=document.createElement("div");header.className="header-row";
    const nameInput=document.createElement("input");nameInput.value=event.name;nameInput.disabled=event.status==="terminated";
    nameInput.onchange=e=>{event.name=e.target.value;save();};header.appendChild(nameInput);
    const badge=document.createElement("span");badge.className="status-badge status-"+(event.status||"new");
    badge.textContent = (event.status==="running"?"L√§uft":(event.status==="stopped"?"Pausiert":(event.status==="terminated"?"Terminiert":"Neu")));
    header.appendChild(badge);
    card.appendChild(header);
    // controls
    if(event.status==="new"){let b=document.createElement("button");b.className="btn-primary";b.textContent="Starten";b.onclick=()=>{event.status="running";save();};card.appendChild(b);}
    else if(event.status==="running"){let b=document.createElement("button");b.className="btn-warning";b.textContent="Stoppen";b.onclick=()=>{event.status="stopped";save();};card.appendChild(b);}
    else if(event.status==="stopped"){let b=document.createElement("button");b.className="btn-primary";b.textContent="Fortsetzen";b.onclick=()=>{event.status="running";save();};card.appendChild(b);}
    if(event.status!=="terminated"){let b=document.createElement("button");b.className="btn-danger";b.textContent="Terminieren";b.onclick=()=>{if(confirm("Terminieren?")){event.status="terminated";save();}};card.appendChild(b);}
    if(event.status==="terminated"){let b=document.createElement("button");b.className="btn-accent";b.textContent="Teilen";b.onclick=()=>shareEvent(event);card.appendChild(b);}
    let del=document.createElement("button");del.className="btn-ghost";del.textContent="Event l√∂schen";
    del.onclick=()=>{if(confirm("Event in Papierkorb verschieben?")){trash.events.push({...event});events.splice(idx,1);save();renderTrash();updateTrashCount();}};card.appendChild(del);
    // entries
    event.entries.forEach(entry=>{
      const row=document.createElement("div");row.className="entry-row";
      const inp=document.createElement("input");inp.value=entry.label;inp.disabled=event.status==="terminated";
      inp.onchange=e=>{entry.label=e.target.value;save();};row.appendChild(inp);
      if(event.status!=="terminated"){let d=document.createElement("button");d.className="btn-ghost";d.textContent="L√∂schen";
        d.onclick=()=>{if(confirm("Eintrag l√∂schen?")){trash.entries.push({...entry,parentId:event.id,parentName:event.name});event.entries=event.entries.filter(en=>en.id!==entry.id);save();renderTrash();updateTrashCount();}};row.appendChild(d);}
      card.appendChild(row);
    });
    if(event.status!=="terminated"){let add=document.createElement("button");add.className="btn-primary";add.textContent="+ Eintrag";add.onclick=()=>{event.entries.push({id:crypto.randomUUID(),label:"Neuer Eintrag",count:0});save();};card.appendChild(add);}
    // count
    const cdiv=document.createElement("div");cdiv.className="count-buttons";
    event.entries.forEach((entry,i)=>{let b=document.createElement("button");b.textContent=`${entry.label} (${entry.count})`;if(event.status==="running"){b.onclick=()=>{event.entries[i].count++;save();};}else b.disabled=true;cdiv.appendChild(b);});card.appendChild(cdiv);
    eventsDiv.appendChild(card);
  });
}
function toggleTrash(){let t=document.getElementById("trash");t.style.display=t.style.display==="none"?"block":"none";if(t.style.display==="block")renderTrash();}
function renderTrash(){
  const evDiv=document.getElementById("trash-events");const enDiv=document.getElementById("trash-entries");
  evDiv.innerHTML="<h3>Events</h3>";trash.events.forEach((e,i)=>{let wrap=document.createElement("div");wrap.className="trash-item";wrap.innerHTML=`<strong>${e.name}</strong>`;
    let restore=document.createElement("button");restore.textContent="Wiederherstellen";restore.onclick=()=>{events.push(e);trash.events.splice(i,1);save();renderTrash();updateTrashCount();};
    let purge=document.createElement("button");purge.textContent="Endg√ºltig l√∂schen";purge.onclick=()=>{trash.events.splice(i,1);renderTrash();updateTrashCount();};
    wrap.append(restore,purge);evDiv.appendChild(wrap);});
  enDiv.innerHTML="<h3>Eintr√§ge</h3>";trash.entries.forEach((en,i)=>{let wrap=document.createElement("div");wrap.className="trash-item";wrap.innerHTML=`<strong>${en.label}</strong> <small>(Event: ${en.parentName||en.parentId})</small>`;
    let restore=document.createElement("button");restore.textContent="Wiederherstellen";restore.onclick=()=>{let parent=events.find(ev=>ev.id===en.parentId);if(parent){parent.entries.push(en);trash.entries.splice(i,1);save();renderTrash();updateTrashCount();}else alert("Event nicht mehr vorhanden");};
    let purge=document.createElement("button");purge.textContent="Endg√ºltig l√∂schen";purge.onclick=()=>{trash.entries.splice(i,1);renderTrash();updateTrashCount();};
    wrap.append(restore,purge);enDiv.appendChild(wrap);});
}
function updateTrashCount(){document.getElementById("trash-count").textContent=trash.events.length+trash.entries.length;}
function emptyTrash(){if(confirm("Papierkorb endg√ºltig leeren?")){trash.events=[];trash.entries=[];renderTrash();updateTrashCount();}}
render();
</script>
</body>
</html>
